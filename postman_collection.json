{
  "info": {
    "name": "Order Book API - Phase 2 Features",
    "description": "Complete test suite for Phase 2 features: TIF, STP, Post-Only, Market Orders, and WebSocket.\n\nTests are organized in sequence and include automated validation.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "2.0.0"
  },
  "item": [
    {
      "name": "Setup & Health Check",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "Verify server is running"
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response contains status', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData.status).to.eql('healthy');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Exchange Metrics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/metrics/exchange",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "metrics", "exchange"]
            },
            "description": "Get initial exchange state"
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has required metrics', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('total_trades');",
                  "    pm.expect(jsonData).to.have.property('total_volume');",
                  "    pm.expect(jsonData).to.have.property('total_fees_collected');",
                  "    pm.expect(jsonData).to.have.property('active_orders');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Phase 1 - Baseline Tests",
      "item": [
        {
          "name": "Submit Basic Limit Order (Sell)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"AAPL\",\n  \"side\": \"sell\",\n  \"order_type\": \"limit\",\n  \"price\": 150.50,\n  \"quantity\": 100,\n  \"user_id\": \"seller1\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            },
            "description": "Basic limit sell order (Phase 1 feature)"
          },
          "response": [
            {
              "name": "Success - Order Added to Book",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"symbol\": \"AAPL\",\n  \"side\": \"sell\",\n  \"order_type\": \"limit\",\n  \"price\": 150.50,\n  \"quantity\": 100,\n  \"user_id\": \"seller1\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{base_url}}/api/v1/orders",
                  "host": ["{{base_url}}"],
                  "path": ["api", "v1", "orders"]
                }
              },
              "status": "Created",
              "code": 201,
              "_postman_previewlanguage": "json",
              "header": [],
              "cookie": [],
              "body": "{\n  \"order_id\": \"123e4567-e89b-12d3-a456-426614174000\",\n  \"status\": \"new\",\n  \"filled_quantity\": \"0\",\n  \"trades\": [],\n  \"timestamp\": \"2025-11-19T10:30:00Z\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Order created successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('order_id');",
                  "    pm.expect(jsonData.status).to.eql('new');",
                  "    pm.expect(jsonData.filled_quantity).to.eql('0');",
                  "    pm.expect(jsonData.trades).to.be.an('array').that.is.empty;",
                  "    ",
                  "    // Save order ID for later tests",
                  "    pm.environment.set('last_order_id', jsonData.order_id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Submit Matching Buy Order",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"AAPL\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 150.50,\n  \"quantity\": 50,\n  \"user_id\": \"buyer1\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            },
            "description": "Buy order that matches the sell order"
          },
          "response": [
            {
              "name": "Success - Order Matched",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"symbol\": \"AAPL\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 150.50,\n  \"quantity\": 50,\n  \"user_id\": \"buyer1\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{base_url}}/api/v1/orders",
                  "host": ["{{base_url}}"],
                  "path": ["api", "v1", "orders"]
                }
              },
              "status": "Created",
              "code": 201,
              "_postman_previewlanguage": "json",
              "header": [],
              "cookie": [],
              "body": "{\n  \"order_id\": \"223e4567-e89b-12d3-a456-426614174001\",\n  \"status\": \"filled\",\n  \"filled_quantity\": \"50\",\n  \"trades\": [\n    {\n      \"trade_id\": \"323e4567-e89b-12d3-a456-426614174002\",\n      \"price\": \"150.50\",\n      \"quantity\": \"50\",\n      \"maker_fee\": \"7.525\",\n      \"taker_fee\": \"15.05\",\n      \"timestamp\": \"2025-11-19T10:30:01Z\"\n    }\n  ],\n  \"timestamp\": \"2025-11-19T10:30:01Z\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Order filled with trade', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql('filled');",
                  "    pm.expect(jsonData.filled_quantity).to.eql('50');",
                  "    pm.expect(jsonData.trades).to.be.an('array').with.lengthOf(1);",
                  "});",
                  "",
                  "pm.test('Trade executed at correct price', function () {",
                  "    const jsonData = pm.response.json();",
                  "    const trade = jsonData.trades[0];",
                  "    pm.expect(trade.price).to.eql('150.50');",
                  "    pm.expect(trade.quantity).to.eql('50');",
                  "});",
                  "",
                  "pm.test('Fees calculated correctly', function () {",
                  "    const jsonData = pm.response.json();",
                  "    const trade = jsonData.trades[0];",
                  "    // Trade value: 150.50 * 50 = 7525",
                  "    // Maker fee (0.10%): 7.525",
                  "    // Taker fee (0.20%): 15.05",
                  "    pm.expect(parseFloat(trade.maker_fee)).to.be.closeTo(7.525, 0.01);",
                  "    pm.expect(parseFloat(trade.taker_fee)).to.be.closeTo(15.05, 0.01);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Phase 2 - Post-Only Orders",
      "item": [
        {
          "name": "Setup: Add Sell Order at 155.00",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"GOOGL\",\n  \"side\": \"sell\",\n  \"order_type\": \"limit\",\n  \"price\": 155.00,\n  \"quantity\": 100,\n  \"user_id\": \"seller1\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Setup order created', function () {",
                  "    pm.response.to.have.status(201);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Post-Only: Should REJECT (would match)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"GOOGL\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 155.00,\n  \"quantity\": 50,\n  \"user_id\": \"buyer1\",\n  \"post_only\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            },
            "description": "Post-only order at same price as best ask - should be REJECTED"
          },
          "response": [
            {
              "name": "Error - Post-Only Would Match",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"symbol\": \"GOOGL\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 155.00,\n  \"quantity\": 50,\n  \"user_id\": \"buyer1\",\n  \"post_only\": true\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{base_url}}/api/v1/orders",
                  "host": ["{{base_url}}"],
                  "path": ["api", "v1", "orders"]
                }
              },
              "status": "Bad Request",
              "code": 400,
              "_postman_previewlanguage": "json",
              "header": [],
              "cookie": [],
              "body": "{\n  \"error\": \"Bad Request\",\n  \"message\": \"Post-only order would match immediately\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400 (Bad Request)', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('Error message indicates post-only rejection', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('Post-only');",
                  "    pm.expect(jsonData.message).to.include('would match');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Post-Only: Should ACCEPT (adds liquidity)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"GOOGL\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 154.50,\n  \"quantity\": 50,\n  \"user_id\": \"buyer1\",\n  \"post_only\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            },
            "description": "Post-only order below best ask - should be ACCEPTED"
          },
          "response": [
            {
              "name": "Success - Order Added",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"symbol\": \"GOOGL\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 154.50,\n  \"quantity\": 50,\n  \"user_id\": \"buyer1\",\n  \"post_only\": true\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{base_url}}/api/v1/orders",
                  "host": ["{{base_url}}"],
                  "path": ["api", "v1", "orders"]
                }
              },
              "status": "Created",
              "code": 201,
              "_postman_previewlanguage": "json",
              "header": [],
              "cookie": [],
              "body": "{\n  \"order_id\": \"423e4567-e89b-12d3-a456-426614174003\",\n  \"status\": \"new\",\n  \"filled_quantity\": \"0\",\n  \"trades\": [],\n  \"timestamp\": \"2025-11-19T10:31:00Z\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Post-only order accepted (adds liquidity)', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql('new');",
                  "    pm.expect(jsonData.filled_quantity).to.eql('0');",
                  "    pm.expect(jsonData.trades).to.be.empty;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Phase 2 - Self-Trade Prevention",
      "item": [
        {
          "name": "STP Setup: Sell Order from MM1",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"MSFT\",\n  \"side\": \"sell\",\n  \"order_type\": \"limit\",\n  \"price\": 370.00,\n  \"quantity\": 100,\n  \"user_id\": \"mm1\",\n  \"stp_mode\": \"CANCEL_RESTING\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Setup order created', function () {",
                  "    pm.response.to.have.status(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.environment.set('mm1_sell_order_id', jsonData.order_id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "STP: Buy from Same User (Should Prevent Self-Trade)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"MSFT\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 370.00,\n  \"quantity\": 50,\n  \"user_id\": \"mm1\",\n  \"stp_mode\": \"CANCEL_RESTING\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            },
            "description": "Same user (mm1) places buy order - STP should cancel resting sell order"
          },
          "response": [
            {
              "name": "Success - No Self-Trade",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"symbol\": \"MSFT\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 370.00,\n  \"quantity\": 50,\n  \"user_id\": \"mm1\",\n  \"stp_mode\": \"CANCEL_RESTING\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{base_url}}/api/v1/orders",
                  "host": ["{{base_url}}"],
                  "path": ["api", "v1", "orders"]
                }
              },
              "status": "Created",
              "code": 201,
              "_postman_previewlanguage": "json",
              "header": [],
              "cookie": [],
              "body": "{\n  \"order_id\": \"523e4567-e89b-12d3-a456-426614174004\",\n  \"status\": \"new\",\n  \"filled_quantity\": \"0\",\n  \"trades\": [],\n  \"timestamp\": \"2025-11-19T10:32:00Z\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('No self-trade occurred', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.trades).to.be.an('array').that.is.empty;",
                  "    pm.expect(jsonData.filled_quantity).to.eql('0');",
                  "});",
                  "",
                  "pm.test('STP mode prevented self-match', function () {",
                  "    // Resting order should have been cancelled (CANCEL_RESTING mode)",
                  "    // Incoming order should be added to book",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql('new');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Phase 2 - IOC Orders",
      "item": [
        {
          "name": "IOC Setup: Add Partial Liquidity",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"TSLA\",\n  \"side\": \"sell\",\n  \"order_type\": \"limit\",\n  \"price\": 200.00,\n  \"quantity\": 50,\n  \"user_id\": \"seller1\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Setup order created', function () {",
                  "    pm.response.to.have.status(201);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "IOC: Partial Fill (100 requested, 50 available)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"TSLA\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 200.00,\n  \"quantity\": 100,\n  \"user_id\": \"buyer1\",\n  \"time_in_force\": \"IOC\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            },
            "description": "IOC order for 100, only 50 available - should fill 50 and cancel remainder"
          },
          "response": [
            {
              "name": "Success - Partial Fill",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"symbol\": \"TSLA\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 200.00,\n  \"quantity\": 100,\n  \"user_id\": \"buyer1\",\n  \"time_in_force\": \"IOC\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{base_url}}/api/v1/orders",
                  "host": ["{{base_url}}"],
                  "path": ["api", "v1", "orders"]
                }
              },
              "status": "Created",
              "code": 201,
              "_postman_previewlanguage": "json",
              "header": [],
              "cookie": [],
              "body": "{\n  \"order_id\": \"623e4567-e89b-12d3-a456-426614174005\",\n  \"status\": \"partially_filled\",\n  \"filled_quantity\": \"50\",\n  \"trades\": [\n    {\n      \"trade_id\": \"723e4567-e89b-12d3-a456-426614174006\",\n      \"price\": \"200.00\",\n      \"quantity\": \"50\",\n      \"maker_fee\": \"10.00\",\n      \"taker_fee\": \"20.00\",\n      \"timestamp\": \"2025-11-19T10:33:00Z\"\n    }\n  ],\n  \"timestamp\": \"2025-11-19T10:33:00Z\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('IOC order partially filled', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql('partially_filled');",
                  "    pm.expect(jsonData.filled_quantity).to.eql('50');",
                  "});",
                  "",
                  "pm.test('IOC filled 50 out of 100 requested', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.trades).to.have.lengthOf(1);",
                  "    pm.expect(jsonData.trades[0].quantity).to.eql('50');",
                  "});",
                  "",
                  "pm.test('Remainder cancelled (not in book)', function () {",
                  "    // IOC orders don't rest in book",
                  "    // Only 50/100 filled, remaining 50 cancelled",
                  "    const jsonData = pm.response.json();",
                  "    const filled = parseFloat(jsonData.filled_quantity);",
                  "    pm.expect(filled).to.equal(50);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Phase 2 - FOK Orders",
      "item": [
        {
          "name": "FOK Setup: Add Insufficient Liquidity",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"NVDA\",\n  \"side\": \"sell\",\n  \"order_type\": \"limit\",\n  \"price\": 500.00,\n  \"quantity\": 30,\n  \"user_id\": \"seller1\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Setup order created', function () {",
                  "    pm.response.to.have.status(201);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "FOK: Should REJECT (insufficient liquidity)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"NVDA\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 500.00,\n  \"quantity\": 100,\n  \"user_id\": \"buyer1\",\n  \"time_in_force\": \"FOK\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            },
            "description": "FOK for 100, only 30 available - should REJECT entirely"
          },
          "response": [
            {
              "name": "Error - FOK Rejected",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"symbol\": \"NVDA\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 500.00,\n  \"quantity\": 100,\n  \"user_id\": \"buyer1\",\n  \"time_in_force\": \"FOK\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{base_url}}/api/v1/orders",
                  "host": ["{{base_url}}"],
                  "path": ["api", "v1", "orders"]
                }
              },
              "status": "Bad Request",
              "code": 400,
              "_postman_previewlanguage": "json",
              "header": [],
              "cookie": [],
              "body": "{\n  \"error\": \"Bad Request\",\n  \"message\": \"Fill-or-kill order cannot be completely filled\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test('FOK rejected due to insufficient liquidity', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('Fill-or-kill');",
                  "    pm.expect(jsonData.message).to.include('cannot be completely filled');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "FOK Setup: Add Sufficient Liquidity",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"NVDA\",\n  \"side\": \"sell\",\n  \"order_type\": \"limit\",\n  \"price\": 500.00,\n  \"quantity\": 200,\n  \"user_id\": \"seller2\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Setup order created', function () {",
                  "    pm.response.to.have.status(201);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "FOK: Should ACCEPT (sufficient liquidity)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"NVDA\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 500.00,\n  \"quantity\": 100,\n  \"user_id\": \"buyer1\",\n  \"time_in_force\": \"FOK\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            },
            "description": "FOK for 100 with sufficient liquidity - should FILL completely"
          },
          "response": [
            {
              "name": "Success - FOK Filled",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"symbol\": \"NVDA\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 500.00,\n  \"quantity\": 100,\n  \"user_id\": \"buyer1\",\n  \"time_in_force\": \"FOK\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{base_url}}/api/v1/orders",
                  "host": ["{{base_url}}"],
                  "path": ["api", "v1", "orders"]
                }
              },
              "status": "Created",
              "code": 201,
              "_postman_previewlanguage": "json",
              "header": [],
              "cookie": [],
              "body": "{\n  \"order_id\": \"823e4567-e89b-12d3-a456-426614174007\",\n  \"status\": \"filled\",\n  \"filled_quantity\": \"100\",\n  \"trades\": [\n    {\n      \"trade_id\": \"923e4567-e89b-12d3-a456-426614174008\",\n      \"price\": \"500.00\",\n      \"quantity\": \"100\",\n      \"maker_fee\": \"50.00\",\n      \"taker_fee\": \"100.00\",\n      \"timestamp\": \"2025-11-19T10:34:00Z\"\n    }\n  ],\n  \"timestamp\": \"2025-11-19T10:34:00Z\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('FOK order completely filled', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql('filled');",
                  "    pm.expect(jsonData.filled_quantity).to.eql('100');",
                  "});",
                  "",
                  "pm.test('All 100 shares filled atomically', function () {",
                  "    const jsonData = pm.response.json();",
                  "    const totalFilled = jsonData.trades.reduce((sum, trade) => {",
                  "        return sum + parseFloat(trade.quantity);",
                  "    }, 0);",
                  "    pm.expect(totalFilled).to.equal(100);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Phase 2 - Market Orders & VWAP",
      "item": [
        {
          "name": "Market Order Setup: Multiple Price Levels",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "[\n  {\n    \"symbol\": \"META\",\n    \"side\": \"sell\",\n    \"order_type\": \"limit\",\n    \"price\": 300.00,\n    \"quantity\": 100,\n    \"user_id\": \"seller1\"\n  },\n  {\n    \"symbol\": \"META\",\n    \"side\": \"sell\",\n    \"order_type\": \"limit\",\n    \"price\": 300.50,\n    \"quantity\": 100,\n    \"user_id\": \"seller2\"\n  },\n  {\n    \"symbol\": \"META\",\n    \"side\": \"sell\",\n    \"order_type\": \"limit\",\n    \"price\": 301.00,\n    \"quantity\": 100,\n    \"user_id\": \"seller3\"\n  }\n]"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            },
            "description": "NOTE: This is a single request for demo. In practice, send 3 separate requests."
          },
          "response": []
        },
        {
          "name": "Market Order: Buy 250 (Multi-Level Match)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"META\",\n  \"side\": \"buy\",\n  \"order_type\": \"market\",\n  \"quantity\": 250,\n  \"user_id\": \"buyer1\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            },
            "description": "Market buy for 250 shares - should match across 3 price levels"
          },
          "response": [
            {
              "name": "Success - Multi-Level Fill",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"symbol\": \"META\",\n  \"side\": \"buy\",\n  \"order_type\": \"market\",\n  \"quantity\": 250,\n  \"user_id\": \"buyer1\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{base_url}}/api/v1/orders",
                  "host": ["{{base_url}}"],
                  "path": ["api", "v1", "orders"]
                }
              },
              "status": "Created",
              "code": 201,
              "_postman_previewlanguage": "json",
              "header": [],
              "cookie": [],
              "body": "{\n  \"order_id\": \"a23e4567-e89b-12d3-a456-426614174009\",\n  \"status\": \"filled\",\n  \"filled_quantity\": \"250\",\n  \"trades\": [\n    {\n      \"trade_id\": \"b23e4567-e89b-12d3-a456-42661417400a\",\n      \"price\": \"300.00\",\n      \"quantity\": \"100\",\n      \"maker_fee\": \"30.00\",\n      \"taker_fee\": \"60.00\",\n      \"timestamp\": \"2025-11-19T10:35:00Z\"\n    },\n    {\n      \"trade_id\": \"c23e4567-e89b-12d3-a456-42661417400b\",\n      \"price\": \"300.50\",\n      \"quantity\": \"100\",\n      \"maker_fee\": \"30.05\",\n      \"taker_fee\": \"60.10\",\n      \"timestamp\": \"2025-11-19T10:35:00Z\"\n    },\n    {\n      \"trade_id\": \"d23e4567-e89b-12d3-a456-42661417400c\",\n      \"price\": \"301.00\",\n      \"quantity\": \"50\",\n      \"maker_fee\": \"15.05\",\n      \"taker_fee\": \"30.10\",\n      \"timestamp\": \"2025-11-19T10:35:00Z\"\n    }\n  ],\n  \"timestamp\": \"2025-11-19T10:35:00Z\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Market order filled completely', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql('filled');",
                  "    pm.expect(jsonData.filled_quantity).to.eql('250');",
                  "});",
                  "",
                  "pm.test('Matched across multiple price levels', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.trades).to.have.length.of.at.least(2);",
                  "});",
                  "",
                  "pm.test('Calculate VWAP', function () {",
                  "    const jsonData = pm.response.json();",
                  "    let totalValue = 0;",
                  "    let totalQuantity = 0;",
                  "    ",
                  "    jsonData.trades.forEach(trade => {",
                  "        const price = parseFloat(trade.price);",
                  "        const qty = parseFloat(trade.quantity);",
                  "        totalValue += price * qty;",
                  "        totalQuantity += qty;",
                  "    });",
                  "    ",
                  "    const vwap = totalValue / totalQuantity;",
                  "    console.log('VWAP:', vwap);",
                  "    ",
                  "    // VWAP should be between best and worst price",
                  "    // (300 * 100 + 300.50 * 100 + 301 * 50) / 250 = 300.30",
                  "    pm.expect(vwap).to.be.closeTo(300.30, 0.01);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Phase 2 - Get Order with New Fields",
      "item": [
        {
          "name": "Create Order with All Phase 2 Fields",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"symbol\": \"AMZN\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": 180.00,\n  \"quantity\": 100,\n  \"user_id\": \"trader1\",\n  \"time_in_force\": \"GTC\",\n  \"stp_mode\": \"CANCEL_RESTING\",\n  \"post_only\": false\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/orders",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Order created', function () {",
                  "    pm.response.to.have.status(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.environment.set('phase2_order_id', jsonData.order_id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Order - Verify Phase 2 Fields",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/orders/AMZN/{{phase2_order_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orders", "AMZN", "{{phase2_order_id}}"]
            }
          },
          "response": [
            {
              "name": "Success - With Phase 2 Fields",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url}}/api/v1/orders/AMZN/e23e4567-e89b-12d3-a456-42661417400d",
                  "host": ["{{base_url}}"],
                  "path": ["api", "v1", "orders", "AMZN", "e23e4567-e89b-12d3-a456-42661417400d"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [],
              "cookie": [],
              "body": "{\n  \"order_id\": \"e23e4567-e89b-12d3-a456-42661417400d\",\n  \"symbol\": \"AMZN\",\n  \"side\": \"buy\",\n  \"order_type\": \"limit\",\n  \"price\": \"180.00\",\n  \"quantity\": \"100\",\n  \"filled_quantity\": \"0\",\n  \"status\": \"new\",\n  \"time_in_force\": \"GTC\",\n  \"stp_mode\": \"CANCEL_RESTING\",\n  \"post_only\": false,\n  \"expire_time\": null,\n  \"timestamp\": \"2025-11-19T10:36:00Z\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response includes Phase 2 fields', function () {",
                  "    const jsonData = pm.response.json();",
                  "    ",
                  "    // Phase 1 fields",
                  "    pm.expect(jsonData).to.have.property('order_id');",
                  "    pm.expect(jsonData).to.have.property('symbol');",
                  "    pm.expect(jsonData).to.have.property('side');",
                  "    pm.expect(jsonData).to.have.property('order_type');",
                  "    pm.expect(jsonData).to.have.property('price');",
                  "    pm.expect(jsonData).to.have.property('quantity');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    ",
                  "    // Phase 2 NEW fields",
                  "    pm.expect(jsonData).to.have.property('time_in_force');",
                  "    pm.expect(jsonData).to.have.property('stp_mode');",
                  "    pm.expect(jsonData).to.have.property('post_only');",
                  "    pm.expect(jsonData).to.have.property('expire_time');",
                  "});",
                  "",
                  "pm.test('Phase 2 field values are correct', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.time_in_force).to.eql('GTC');",
                  "    pm.expect(jsonData.stp_mode).to.eql('CANCEL_RESTING');",
                  "    pm.expect(jsonData.post_only).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Phase 2 - Order Book & Trades",
      "item": [
        {
          "name": "Get Order Book",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/orderbook/AAPL?depth=5",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "orderbook", "AAPL"],
              "query": [
                {
                  "key": "depth",
                  "value": "5"
                }
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Order book has required fields', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('symbol');",
                  "    pm.expect(jsonData).to.have.property('bids');",
                  "    pm.expect(jsonData).to.have.property('asks');",
                  "    pm.expect(jsonData).to.have.property('best_bid');",
                  "    pm.expect(jsonData).to.have.property('best_ask');",
                  "    pm.expect(jsonData).to.have.property('spread');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Recent Trades",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/trades/AAPL?limit=10",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "trades", "AAPL"],
              "query": [
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Trades response has correct structure', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('symbol');",
                  "    pm.expect(jsonData).to.have.property('trades');",
                  "    pm.expect(jsonData).to.have.property('count');",
                  "    pm.expect(jsonData.trades).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://127.0.0.1:3000",
      "type": "default"
    }
  ]
}
